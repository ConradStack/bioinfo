

convert2indices = function(str){
	tmp = strsplit(str,"")[[1]]
	sapply(tmp,switch,"A"=1,"C"=2,"G"=3,"T"=4)
}

# test = "ACCTGTTTATTGCCTAAGTTCCGAACAAACCCAATATAGCCCGAGGGCCT"
# ksize = 5
# profile = matrix(c(
# 0.2,0.2,0.3,0.2,0.3,
# 0.4,0.3,0.1,0.5,0.1,
# 0.3,0.3,0.5,0.2,0.4,
# 0.1,0.2,0.1,0.1,0.2
# ), nrow=4,ncol=ksize,byrow=T)

# test = "TGCCCGAGCTATCTTATGCGCATCGCATGCGGACCCTTCCCTAGGCTTGTCGCAAGCCATTATCCTGGGCGCTAGTTGCGCGAGTATTGTCAGACCTGATGACGCTGTAAGCTAGCGTGTTCAGCGGCGCGCAATGAGCGGTTTAGATCACAGAATCCTTTGGCGTATTCCTATCCGTTACATCACCTTCCTCACCCCTA"
# ksize=6
# profile = matrix(c(
# 0.364,0.333,0.303,0.212,0.121,0.242,
# 0.182,0.182,0.212,0.303,0.182,0.303,
# 0.121,0.303,0.182,0.273,0.333,0.303,
# 0.333,0.182,0.303,0.212,0.364,0.152
# ), nrow=4,ncol=ksize,byrow=T)

test = "CCTGTTTATCTGGACATATCCAGCTATGACTTGCGGGTACGGTCACCCACCTCGGCGTGGAGCTCCAAACCCGAAGACCTTTCAAATCCTGCTGAACAGCTAAAGGACAGCCTAGGAAGCTACTATCTGCACCGGGTGCAGATCGGGCATGCATAGCGAATGGGAGCCAAGTTCTTTCTATAGGTTCCGCGTGCGTACAAGTCGTACATCGACGGAAAAGAGGTGCAGTTGAAGGTGAAATAAGCCTTTCAACCGAGCCGATAATGGGAAAGCTTTAGTTTTGTTGGAAACCTCGTATGGTGGACTTCTCCATATAAGTAAATGTCTAACTGTTCATTAACGAAGAACGCGGTCATCAGGACGGAACAGAGCTATGATGAGCACGTTTCACGGTGACATAGGTGACTTATAGCCCGTCTCCGCCTTGAACCTGTCTAACAAATACGTCGTCGCAAATCAGCTTCCCTCAAAGAGCCGTTCAAGTCACGAACGATGAGGCCAAAGAACGCTACCTCTCTAGTCTTATGTGCGCCTAGAGTCCATCGGTTAGATCTGTGTATTATCTCCATTACGAATAAAGCACTTAATGAGGAGTGGTCTGCGTATCAGCGTATAGGGTAAGGAGTGGCCAGGATGGTTCGTTATCCCGCTCCGTTTGTCAGAGAAGAAAATACGGACCAGAACTAGTGTGCTGTGCGGATAGTACTTACCCGGATCGACCTAGTAACATCATCCCTCGTAGGGATCCACAGCGGCAGCATGACGTCATTTTGTCTCGCGCCCGATTGTAAGGTGTGTCCATCGCCGGCGGGCAAGTGCGAACCCTACGGGTACTATTTTCAAAGATGCAATGTGGCCGTACAAATTTGTAGACCCTTTACACCTACCCAGGGCCCATAGACTCGGCGCTCATGAGATAATGGCGTGATTAACGCCGATATATTAGTCATTGTCTGAAGTCGCATAGGCGGTCTGACGACCCCGACACTCATTGCGGCTA"
ksize= 15
profile = matrix(c(
0.303,0.348,0.136,0.273,0.258,0.242,0.227,0.182,0.258,0.273,0.258,0.348,0.288,0.212,0.212,
0.197,0.197,0.318,0.273,0.197,0.242,0.227,0.227,0.227,0.227,0.152,0.258,0.182,0.212,0.409,
0.258,0.197,0.258,0.182,0.258,0.227,0.258,0.379,0.288,0.318,0.258,0.242,0.348,0.227,0.258,
0.242,0.258,0.288,0.273,0.288,0.288,0.288,0.212,0.227,0.182,0.333,0.152,0.182,0.348,0.121
), nrow=4,ncol=ksize,byrow=T)




maxprob = 0 
maxmer = ""
inds = convert2indices(test)
nout = length(inds)-ksize+1
for(ii in seq( nout )){
	slice = ii:(ii+ksize-1)
	tmpinds = inds[slice]
	thisprob = prod(profile[cbind(tmpinds,1:ksize)])
	if(thisprob > maxprob){
		maxmer = substring(test,slice[1],tail(slice,1))
		maxprob = thisprob
	}
}

